Mitgliedsbeitrag 4.1.1

Dieses Plugin berechnet Mitgliedsbeiträge anhand von Rollenzugehörigkeiten.

1. Installation
2. Update
3. Versionshistorie
4. Systemanforderungen

******************************************************************************

1.1 Im Ordner adm_plugins einen neuen Ordner mit dem Namen mitgliedsbeitrag erstellen

1.2 Alle Dateien (und Ordner) des Ordners mitgliedsbeitrag aus der entpackten Datei mitgliedsbeitrag....zip in diesen Ordner kopieren.

1.3 In der Datei my_body_bottom.php (Ordner adm_themes/modern) folgende Zeilen einfügen:

  1.3.1  Erste Möglichkeit
      Darstellung des Links zum Plugin im vorhandenen Module-Menü

      - dazu DIREKT VOR der vorhandenen Anweisung "echo $moduleMenu->show();" diese Zeile einfügen:
         include(SERVER_PATH.'/adm_plugins/mitgliedsbeitrag/mitgliedsbeitrag.php');

   1.3.2  Zweite Möglichkeit
      Darstellung des Links zum Plugin in einem eigenen Plugin-Menü

       - dazu diese Zeilen einfügen (falls noch nicht vorhanden):
         $pluginMenu = new Menu('plugins', 'Plugins');
         echo $pluginMenu->show(); 

      - und innerhalb dieser Anweisungen den bereits bekannten include-Befehl einfügen
         $pluginMenu = new Menu('plugins', 'Plugins');
         include(SERVER_PATH. '/adm_plugins/mitgliedsbeitrag/mitgliedsbeitrag.php');
         echo $pluginMenu->show(); 
            
   Hinweis: Die include-Anweisung sollte nicht innerhalb einer if-Abfrage stehen. 
            Die Berechtigung, wer das Plugin aufrufen darf, wird über das Einstellungen-Modul festgelegt.
            Standardeinstellung ist: Rolle Webmaster und Rolle Mitglied

1.4 Admidio starten und das Plugin Mitgliedsbeitrag ausführen


******************************************************************************

2. Update
=========

2.1 Alle Dateien im Pluginverzeichnis von Mitgliedsbeitrag löschen.

2.2 wie unter Punkt 1.2 beschrieben

2.3 wie unter Punkt 1.3 beschrieben

2.4 Admidio starten und das Plugin Mitgliedsbeitrag ausführen


WICHTIGER HINWEIS  -  WICHTIGER HINWEIS  -  WICHTIGER HINWEIS  -  WICHTIGER HINWEIS  -  WICHTIGER HINWEIS
Ab 1. Februar 2016 gibt es keine Kontonummern mehr. 
Die Verarbeitung von Kontonummern und Bankleitzahlen durch das Plugin wird deshalb eingestellt.
In der Datenbank vorhandene Kontonummern und Bankleitzahlen werden jedoch NICHT automatisch gelöscht. 

Sollen alle Kontonummern und Bankleitzahlen automatisch gelöscht werden, 
so ist VOR dem Hochladen der PHP-Dateien auf den Server folgendes durchzuführen:

In der Datei configtable.php aus dem Ordner classes
sind die Zeilen 114 und 115
    	//$this->delete_member_data(3,'KONTONUMMER');
    	//$this->delete_member_data(3,'BANKLEITZAHL');
abzuändern in:
    	$this->delete_member_data(3,'KONTONUMMER');
    	$this->delete_member_data(3,'BANKLEITZAHL');
      
Dadurch werden beim ersten Start des Plugins alle Kontonummern, alle Bankleitzahlen und auch die dazugehörigen Profilfelder gelöscht.

 
******************************************************************************

3. Versionshistorie

4.1.1 (17.02.2016)
  - Fehler beim Erzeugen von Mitgliedsnummern behoben (Version 4.1.0 erzeugte für alle Mitglieder neue Mitgliedsnummern)
  
4.1.0 (17.02.2016)
  - Kompatibilität mit Admidio 3.1
  - im Modul Fälligkeitsdatum wurde der Sequenztyp bei -alle ändern- nicht mitgeändert
  - in mehreren Modulen das Aussehen der Hilfe-Popups geändert (Anzeigefehler im Scroll-Bereich unter Admidio 3.1)
  - im Modul Rechnung-Export wird jetzt bei leerer Ausgabe eine Fehlermeldung angezeigt
  - in der Auswahl Squenztyp/Fälligkeitsdatum wurden auch Daten inaktiver Mitglieder angezeigt
  - beim Versenden von Vorabinformationen an mehrere Mitglieder gleichzeitig wurde #creditor_id# nicht aufgelöst 
  - Link zur Dokumentation geändert
                
4.0.0 (09.11.2015)
  - Anpassung an Admidio 3.0
  - Deinstallationsroutine erstellt
  - Modul copy erstellt
  - Verfahren zum Einbinden des Plugins (include) geändert 
  - Menübezeichnungen angepasst (gleichlautend mit anderen Plugins)
  - Erweiterte Überprüfung auf unzulässige Zeichen in den SEPA-XML-Dateien   
  - Nur Intern: Verwaltung der Konfigurationsdaten geändert 

3.3.7 (08.09.2014)
  - wenn ein KtoInh angegeben war und bei diesem die E-Mail-Adresse leer war, wurde eine E-Mail
    an den vorherigen User gesendet --> Fehler behoben
  - %creditor_id% wurde beim E-Mail-Versand nicht immer aufgelöst 
  - die Einschränkung auf die Rolle Mitglied beim Erzeugen von Mitgliedsnummern wurde entfernt

3.3.6 (25.07.2014)
  - IBAN only 
  - beim Setzen eines Bezahlt-Datums wird der Sequenztyp nach RCUR nur beim Vorliegen eines Fälligkeitsdatums geändert
  - im Modul "Fälligkeitsdatum bearbeiten" werden Mitglieder 
    - 1. nur noch bei vorhandenem Beitrag angezeigt, 
    - 2. bei fehlender IBAN nicht mehr angezeigt, 
    - 3. bei vorhandenem Bezahlt-Datum nicht mehr angezeigt
  - im Modul "SEPA Export" werden bei den Auswahlmöglichkeiten der Kombination Fälligkeitsdatum/Sequenztyp
    Mitglieder ohne vorhandenem Beitrag nicht mehr angezeigt
  - Eil-Lastschrift (COR1)
  - Menüpunkt DTA-Export gestrichen
  - Beitragszahlungen kann auf einzelne Beitragsrollen eingeschränkt werden
  - IBAN-Prüfung
  - E-Mail-Versand im Modul Vorabinformation an mehrere Mitglieder gleichzeitig möglich
  - Prüfbedingung zum Übersetzen von Rollen und Kategorien durch Sprachdatei geändert
  - Anzeigeposition des Kalenders in Einstellungen-Altersgestaffelte Rollen angepasst
  - anteilige Beitragsberechnung bis zum Ende einer Rollenmitgliedschaft
  - unter dem Menüpunkt "Einstellungen-Reset" wurden diverse Löschmöglichkeiten entfernt,
    da diese seit der Version 3.3.5 unter "Allgemein-Beitragsberechnung" zu finden sind
  - interne Änderungen (ohne Funktionsänderungen):
    - 1. Module zahlungen_change und zahlungen_save zusammengefasst zu zahlungen_save
    - 2. Module faelligkeitsdatum_change und faelligkeitsdatum_save zusammengefasst zu faelligkeitsdatum_save
    - 3. Module mandatsdatum_change und mandatsdatum_save zusammengefasst zu mandatsdatum_save
    - 4. Menüpunkt "Rollenprüfungen" wurde aufgrund erweiterter Funktionalität umbenannt in "Prüfungen"
    - 5. Menüpunkt "Einstellungen-Reset" wurde umbenannt in "Einstellungen-Löschen"
			    
3.3.5 (12.02.2014)
(Dank an fiwad für die Unterstützung beim Testen dieser Version)
  - Fehler ...indefined index:...language.php line 272... behoben
  - Fehler im Modul Beitragsanalyse behoben (fehlende IBAN-Verknüpfung)
  - Fehler im Modul Neuzuordnung behoben
  - Diakritische Zeichen werden in der SEPA-XML-Datei ersetzt
  - Errechnete Beiträge können aufsummiert werden
  - Beitragsneuberechnung kann auf einzelne Beitragsrollen eingeschränkt werden
  - Initialisierungsroutine überarbeitet
  - SOLL/IST-Anzeige der Setuproutine überarbeitet
  - Link auf Familien im Modul Rollenprüfung geändert
  - Beitragstext gestrafft (Leerzeichen und + entfernt)
  - Fälligkeitsdatum bearbeiten kann auf einzelne Beitragsrollen eingeschränkt werden
  - Rollenprüfung für Familienrollen umfassend neu gestaltet 
  - Menü Beitragsberechnung neu gestaltet

3.3.4 (30.10.2013)
  - Fehler (()) behoben
  - Erweiterung für "mehrere Familienrollen"
  - Erweiterung für "mehrere altersgestaffelte Rollen"
  - E-Mail-Versand in Modul Beitragszahlungen eingearbeitet
  - Ergebnismeldung in Modul Neuzuordnung eingearbeitet 

3.3.3 (13.09.2013)
  - E-Mail-Versand in Modul Vorabinformation eingearbeitet
  - Die Prüfung der Rollenmitgliedschaften kann auf Mitglieder bestimmter Kategorien eingegrenzt werden (Wunsch von joesch)

3.3.2 (01.08.2013)
  - error_reporting überarbeitet

3.3.1 (11.07.2013)
  - Fehler beim Anlegen der Kategorie Kontodaten behoben
             
3.3.0 (02.07.2013)
  - Plugin um SEPA erweitert
  - Einfache Mitgliedsnummern können erzeugt werden 
  - Fehler bei der Anzeige des Beitrag-Suffix bei anteiligen Beiträgen behoben

3.2.0 (26.03.2013)
  - Anpassung an Admidio 2.4
  - Konfigurationsdaten werden nicht mehr in einer config.ini gespeichert, sondern in der Admidio Datenbank abgelegt
  - Rechnungs-Export von guenter47 eingearbeitet
  - Menuestruktur überarbeitet
  - Fehler in der Rollenprüfung "Rollenmitgliedschaft (Ausschluss)" behoben 

3.1.1 (18.01.2013)
  - Im Modul Beitragszahlungen wird jetzt auch der Beitrag angezeigt
  - Ein Fehler beim Speichern des Bezahlt-Datums wurde behoben (function date_format2mysql von eiseli) 
  - Anführungszeichen fehlten in mitgliedsbeitrag_show Zeile 986 (eiseli)
    - alt: (array(cat => $row['cat_name'],rol => $row['rol_name'])
    - neu: (array('cat' => $row['cat_name'],'rol' => $row['rol_name']) 
  - Undefinierte Variablen sind jetzt definiert
  - Eine Sprachdatei deutsch (Sie) wurde erstellt
  - Im Modul Beitragszahlungen wird die Option "Alle ändern" inaktiv gesetzt, wenn im Suchfeld eine Eingabe erfolgt 

3.1.0 (06.12.2012)
  - Ein Fehler beim Speichern der config.ini wurde behoben
  - Das Plugin wurde für "mehrere Organisationen" erweitert
  - Eine upgrade.php wurde erstellt (3.0.0 --> 3.1.x)                  
  - Die Anzeige der Mitgliedsnamen im Beitragstext ist jetzt möglich (Anregung durch hausi)
    (eine Anzeige erfolgt jedoch nur, wenn: Kontoinhaber und Mitgliedsname unterschiedlich sind oder Kontoinhaber leer ist)
  - In der Rollenprüfung werden die angezeigten Benutzernamen und Rollen jetzt mit einem Link hinterlegt (Anregung durch joesch)
  - Das Modul Zahlungen (jetzt Beitragszahlungen) wurde komplett überarbeitet (Anregung durch hausi und walegger)
  - Eine deutsche Sprachdatei wurde erstellt

3.0.0 (25.06.2012)
  - Beiträge aus dem Forum eingearbeitet
  - Rundung der berechneten Mitgliedsbeiträge auf zwei Nachkommastellen
  - Profilfeld Beitritt ist kein Pflichtfeld mehr
  - zusätzlicher Schalter für die anteilige Beitragsberechnung (Berechnung anhand des Beitrittsdatums 
    oder des Beginns einer Rollenzugehörigkeit) 
  - das Präfix für Familienrollen ist beim ersten Aufruf vordefiniert ('Familie')
  - bei Familienrollen kann ein Leiter definiert werden; dieser wird für die Beitragsberechnung herangezogen 
  - ein Fehler in der Beitragsberechnung wurde behoben (bestehende Alt-Beiträge wurden nicht gelöscht )
  - ein Fehler bei der Berechnung des Alters eines Mitglieds, bezogen auf den Stichtag, wurde behoben  

3.0.0 beta 1 (30.05.2012)
  - Das Plugin wurde komplett überarbeitet. Es ist jetzt als Accordion-Menü (ähnl. Administration-Organisationseinstellungen)
    in Admidio integriert. Alle Einstellungen des Plugins sind über das Menü anwählbar. 

2.3.1 (03.03.2012)
  - Ein Fehler bei der Berechnung von Cent-Beträgen wurde behoben  

2.3.0: (21.02.2012)
  - das Plugin ist jetzt Admidio 2.3 kompatibel
  - Über Rollenzugehörigkeiten können fixe Jahresbeiträge berechnet werden. (Alle Mitglieder einer Kategorie
    zahlen einen festen Jahresbeitrag. Die effektiven Beiträge werden von den jeweiligen Rollen der Kategorie
    aus der DB ermittelt.) (hausi)
  - der Fehler bei einem Mitgliedsbeitrag von 0 wurde behoben 

2.2.1 (08.12.2011)
  - das Standard-Datenbankpräfix (adm_) ist nicht mehr fest kodiert

2.2.0 (21.11.2011)
  - Das externe Programm dtaus wird nicht mehr benötigt. Durch die Integration der Klasse DTA ist es jetzt möglich,
    direkt die dtaus-Datei und den dazugehörigen Begleitzettel zu erstellen. 
  - Die Exportdateien und die Bildschirmanzeige wurden in ihrer Struktur vereinheitlicht. Sie weisen jetzt alle
    dieselben Spalten an derselben Position auf.  
  - bisher wurden bei einer Familie die Kontodaten eines zufällig ausgewählten Mitglieds verwendet. Falls genau
    bei diesem Mitglied keine Kontodaten hinterlegt waren, wurde auf Rechnung umgestellt. Dies wurde geändert. 
    Es werden alle Mitglieder einer Familie abgefragt. Nur wenn bei keinem Mitglied Kontodaten hinterlegt sind, 
    wird auf Rechnung umgestellt. 
  - Die Berechtigung das Plugin aufzurufen, wurde um Rollenmitgliedschaften erweitert.

2.1.0 (26.10.2011)
  - Dem Plugin wurde eine Weboberfläche verpasst.
  - Die erzeugte CSV-Datei wird nicht mehr auf dem Server zwischengespeichert, sie wird in der Listenansicht zum Download angeboten. 
  - Das zusätzliche Plugin downloadfile.php wird nicht mehr benötigt.       

2.0.0 (12.07.2011)
  - Neues Feld "Beitritt" für ein Mitglied
  - Berechnung eines Spartenbeitrages
  - Berechnung eines Schüler- und Studentenbeitrages
  - Beiträge können abgerundet werden
  - der Kategoriename für Familien ist frei wählbar    

1.0.1 (10.01.2011)
  - Gerald Lutter

******************************************************************************

4. Systemanforderungen

Das Plugin Mitgliedsbeitrag in der Version 4.1 erfordert Admidio 3.1

Es erstellt XML-Dateien gemäß dem DFÜ-Abkommen Version 2.7 (IBAN only und COR1 Unterstützung).
Stellen Sie sicher, dass Ihre Bank diese XML-Dateien verarbeiten kann.

